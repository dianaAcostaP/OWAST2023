<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>A02 Cryptographic Failures - OWASP Top 10:2021</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">OWASP Top 10:2021</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../0x00-notice/" class="nav-link">Notice</a>
                            </li>
                            <li class="navitem">
                                <a href="../A00_2021_Introduction/" class="nav-link">Introduction</a>
                            </li>
                            <li class="navitem">
                                <a href="../A00_2021_How_to_use_the_OWASP_Top_10_as_a_standard/" class="nav-link">How to use the OWASP Top 10 as a standard</a>
                            </li>
                            <li class="navitem">
                                <a href="../A00_2021-How_to_start_an_AppSec_program_with_the_OWASP_Top_10/" class="nav-link">How to start an AppSec program with the OWASP Top 10</a>
                            </li>
                            <li class="navitem">
                                <a href="../A00-about-owasp/" class="nav-link">About OWASP</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Top 10:2021 List <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../A01_2021-Broken_Access_Control/" class="dropdown-item">A01 Broken Access Control</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">A02 Cryptographic Failures</a>
</li>
                                    
<li>
    <a href="../A03_2021-Injection/" class="dropdown-item">A03 Injection</a>
</li>
                                    
<li>
    <a href="../A04_2021-Insecure_Design/" class="dropdown-item">A04 Insecure Design</a>
</li>
                                    
<li>
    <a href="../A05_2021-Security_Misconfiguration/" class="dropdown-item">A05 Security Misconfiguration</a>
</li>
                                    
<li>
    <a href="../A06_2021-Vulnerable_and_Outdated_Components/" class="dropdown-item">A06 Vulnerable and Outdated Components</a>
</li>
                                    
<li>
    <a href="../A07_2021-Identification_and_Authentication_Failures/" class="dropdown-item">A07 Identification and Authentication Failures</a>
</li>
                                    
<li>
    <a href="../A08_2021-Software_and_Data_Integrity_Failures/" class="dropdown-item">A08 Software and Data Integrity Failures</a>
</li>
                                    
<li>
    <a href="../A09_2021-Security_Logging_and_Monitoring_Failures/" class="dropdown-item">A09 Security Logging and Monitoring Failures</a>
</li>
                                    
<li>
    <a href="../A10_2021-Server-Side_Request_Forgery_%28SSRF%29/" class="dropdown-item">A10 Server Side Request Forgery (SSRF)</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../A11_2021-Next_Steps/" class="nav-link">Next Steps</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                            <li class="nav-item">
                                <a rel="prev" href="../A01_2021-Broken_Access_Control/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../A03_2021-Injection/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/OWASP/Top10/edit/master/docs/A02_2021-Cryptographic_Failures.md" class="nav-link">Edit on OWASP/Top10
                                    </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#a022021-cryptographic-failures" class="nav-link">A02:2021 – Cryptographic Failures</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#factors" class="nav-link">Factors</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#overview" class="nav-link">Overview</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#description" class="nav-link">Description</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#how-to-prevent" class="nav-link">How to Prevent</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#example-attack-scenarios" class="nav-link">Example Attack Scenarios</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#references" class="nav-link">References</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#list-of-mapped-cwes" class="nav-link">List of Mapped CWEs</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<ul>
<li class="i18n-link i18n-link-found i18n-link-ar"><a href="../A02_2021-Cryptographic_Failures.ar/">ar - العربية</a></li>
<li class="i18n-link i18n-link-found i18n-link-es"><a href="../A02_2021-Cryptographic_Failures.es/">es - Español</a></li>
<li class="i18n-link i18n-link-found i18n-link-fr"><a href="../A02_2021-Cryptographic_Failures.fr/">fr - Français</a></li>
<li class="i18n-link i18n-link-found i18n-link-id"><a href="../A02_2021-Cryptographic_Failures.id/">id - Indonesian</a></li>
<li class="i18n-link i18n-link-found i18n-link-it"><a href="../A02_2021-Cryptographic_Failures.it/">it - Italiano</a></li>
<li class="i18n-link i18n-link-found i18n-link-ja"><a href="../A02_2021-Cryptographic_Failures.ja/">ja - 日本語</a></li>
<li class="i18n-link i18n-link-found i18n-link-pt_BR"><a href="../A02_2021-Cryptographic_Failures.pt_BR/">pt_BR - Português (Brasil)</a></li>
<li class="i18n-link i18n-link-found i18n-link-zh_CN"><a href="../A02_2021-Cryptographic_Failures.zh_CN/">zh_CN - 简体中文</a></li>
<li class="i18n-link i18n-link-found i18n-link-zh_TW"><a href="../A02_2021-Cryptographic_Failures.zh_TW/">zh_TW - 繁體中文</a></li>
</ul>
<h1 id="a022021-cryptographic-failures">A02:2021 – Cryptographic Failures    <img align="right" alt="icon" src="../assets/TOP_10_Icons_Final_Crypto_Failures.png" style="height:80px;width:80px" /></h1>
<h2 id="factors">Factors</h2>
<table>
<thead>
<tr>
<th style="text-align: center;">CWEs Mapped</th>
<th style="text-align: center;">Max Incidence Rate</th>
<th style="text-align: center;">Avg Incidence Rate</th>
<th style="text-align: center;">Avg Weighted Exploit</th>
<th style="text-align: center;">Avg Weighted Impact</th>
<th style="text-align: center;">Max Coverage</th>
<th style="text-align: center;">Avg Coverage</th>
<th style="text-align: center;">Total Occurrences</th>
<th style="text-align: center;">Total CVEs</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">29</td>
<td style="text-align: center;">46.44%</td>
<td style="text-align: center;">4.49%</td>
<td style="text-align: center;">7.29</td>
<td style="text-align: center;">6.81</td>
<td style="text-align: center;">79.33%</td>
<td style="text-align: center;">34.85%</td>
<td style="text-align: center;">233,788</td>
<td style="text-align: center;">3,075</td>
</tr>
</tbody>
</table>
<h2 id="overview">Overview</h2>
<p>Shifting up one position to #2, previously known as <em>Sensitive Data
Exposure</em>, which is more of a broad symptom rather than a root cause,
the focus is on failures related to cryptography (or lack thereof).
Which often lead to exposure of sensitive data. Notable Common Weakness Enumerations (CWEs) included
are <em>CWE-259: Use of Hard-coded Password</em>, <em>CWE-327: Broken or Risky
Crypto Algorithm</em>, and <em>CWE-331 Insufficient Entropy</em>.</p>
<h2 id="description">Description</h2>
<p>The first thing is to determine the protection needs of data in transit
and at rest. For example, passwords, credit card numbers, health
records, personal information, and business secrets require extra
protection, mainly if that data falls under privacy laws, e.g., EU's
General Data Protection Regulation (GDPR), or regulations, e.g.,
financial data protection such as PCI Data Security Standard (PCI DSS).
For all such data:</p>
<ul>
<li>
<p>Is any data transmitted in clear text? This concerns protocols such
    as HTTP, SMTP, FTP also using TLS upgrades like STARTTLS. External 
    internet traffic is hazardous. Verify all internal traffic, e.g., 
    between load balancers, web servers, or back-end systems.</p>
</li>
<li>
<p>Are any old or weak cryptographic algorithms or protocols used either 
    by default or in older code?</p>
</li>
<li>
<p>Are default crypto keys in use, weak crypto keys generated or
    re-used, or is proper key management or rotation missing?
    Are crypto keys checked into source code repositories?</p>
</li>
<li>
<p>Is encryption not enforced, e.g., are any HTTP headers (browser)
    security directives or headers missing?</p>
</li>
<li>
<p>Is the received server certificate and the trust chain properly validated? </p>
</li>
<li>
<p>Are initialization vectors ignored, reused, or not generated
    sufficiently secure for the cryptographic mode of operation?
    Is an insecure mode of operation such as ECB in use? Is encryption
    used when authenticated encryption is more appropriate?</p>
</li>
<li>
<p>Are passwords being used as cryptographic keys in absence of a
    password base key derivation function?</p>
</li>
<li>
<p>Is randomness used for cryptographic purposes that was not designed
    to meet cryptographic requirements? Even if the correct function is
    chosen, does it need to be seeded by the developer, and if not, has
    the developer over-written the strong seeding functionality built into
    it with a seed that lacks sufficient entropy/unpredictability?</p>
</li>
<li>
<p>Are deprecated hash functions such as MD5 or SHA1 in use, or are
    non-cryptographic hash functions used when cryptographic hash functions
    are needed?</p>
</li>
<li>
<p>Are deprecated cryptographic padding methods such as PKCS number 1 v1.5
    in use?</p>
</li>
<li>
<p>Are cryptographic error messages or side channel information
    exploitable, for example in the form of padding oracle attacks?</p>
</li>
</ul>
<p>See ASVS Crypto (V7), Data Protection (V9), and SSL/TLS (V10)</p>
<h2 id="how-to-prevent">How to Prevent</h2>
<p>Do the following, at a minimum, and consult the references:</p>
<ul>
<li>
<p>Classify data processed, stored, or transmitted by an application.
    Identify which data is sensitive according to privacy laws,
    regulatory requirements, or business needs.</p>
</li>
<li>
<p>Don't store sensitive data unnecessarily. Discard it as soon as
    possible or use PCI DSS compliant tokenization or even truncation.
    Data that is not retained cannot be stolen.</p>
</li>
<li>
<p>Make sure to encrypt all sensitive data at rest.</p>
</li>
<li>
<p>Ensure up-to-date and strong standard algorithms, protocols, and
    keys are in place; use proper key management.</p>
</li>
<li>
<p>Encrypt all data in transit with secure protocols such as TLS with
    forward secrecy (FS) ciphers, cipher prioritization by the
    server, and secure parameters. Enforce encryption using directives
    like HTTP Strict Transport Security (HSTS).</p>
</li>
<li>
<p>Disable caching for response that contain sensitive data.</p>
</li>
<li>
<p>Apply required security controls as per the data classification.</p>
</li>
<li>
<p>Do not use legacy protocols such as FTP and SMTP for transporting
    sensitive data.</p>
</li>
<li>
<p>Store passwords using strong adaptive and salted hashing functions
    with a work factor (delay factor), such as Argon2, scrypt, bcrypt or
    PBKDF2.</p>
</li>
<li>
<p>Initialization vectors must be chosen appropriate for the mode of
    operation.  For many modes, this means using a CSPRNG (cryptographically
    secure pseudo random number generator).  For modes that require a
    nonce, then the initialization vector (IV) does not need a CSPRNG.  In all cases, the IV
    should never be used twice for a fixed key.</p>
</li>
<li>
<p>Always use authenticated encryption instead of just encryption.</p>
</li>
<li>
<p>Keys should be generated cryptographically randomly and stored in
    memory as byte arrays. If a password is used, then it must be converted
    to a key via an appropriate password base key derivation function.</p>
</li>
<li>
<p>Ensure that cryptographic randomness is used where appropriate, and
    that it has not been seeded in a predictable way or with low entropy.
    Most modern APIs do not require the developer to seed the CSPRNG to
    get security.</p>
</li>
<li>
<p>Avoid deprecated cryptographic functions and padding schemes, such as
    MD5, SHA1, PKCS number 1 v1.5 .</p>
</li>
<li>
<p>Verify independently the effectiveness of configuration and
    settings.</p>
</li>
</ul>
<h2 id="example-attack-scenarios">Example Attack Scenarios</h2>
<p><strong>Scenario #1</strong>: An application encrypts credit card numbers in a
database using automatic database encryption. However, this data is
automatically decrypted when retrieved, allowing a SQL injection flaw to
retrieve credit card numbers in clear text.</p>
<p><strong>Scenario #2</strong>: A site doesn't use or enforce TLS for all pages or
supports weak encryption. An attacker monitors network traffic (e.g., at
an insecure wireless network), downgrades connections from HTTPS to
HTTP, intercepts requests, and steals the user's session cookie. The
attacker then replays this cookie and hijacks the user's (authenticated)
session, accessing or modifying the user's private data. Instead of the
above they could alter all transported data, e.g., the recipient of a
money transfer.</p>
<p><strong>Scenario #3</strong>: The password database uses unsalted or simple hashes to
store everyone's passwords. A file upload flaw allows an attacker to
retrieve the password database. All the unsalted hashes can be exposed
with a rainbow table of pre-calculated hashes. Hashes generated by
simple or fast hash functions may be cracked by GPUs, even if they were
salted.</p>
<h2 id="references">References</h2>
<ul>
<li>
<p><a href="https://owasp.org/www-project-proactive-controls/v3/en/c8-protect-data-everywhere">OWASP Proactive Controls: Protect Data Everywhere</a></p>
</li>
<li>
<p><a href="https://owasp.org/www-project-application-security-verification-standard">OWASP Application Security Verification Standard (V7, 9, 10)</a></p>
</li>
<li>
<p><a href="https://cheatsheetseries.owasp.org/cheatsheets/Transport_Layer_Protection_Cheat_Sheet.html">OWASP Cheat Sheet: Transport Layer Protection</a></p>
</li>
<li>
<p><a href="https://cheatsheetseries.owasp.org/cheatsheets/User_Privacy_Protection_Cheat_Sheet.html">OWASP Cheat Sheet: User Privacy Protection</a></p>
</li>
<li>
<p><a href="https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html">OWASP Cheat Sheet: Password Storage</a></p>
</li>
<li>
<p><a href="https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html">OWASP Cheat Sheet: Cryptographic Storage</a></p>
</li>
<li>
<p><a href="https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Strict_Transport_Security_Cheat_Sheet.html">OWASP Cheat Sheet: HSTS</a></p>
</li>
<li>
<p><a href="https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/09-Testing_for_Weak_Cryptography/README">OWASP Testing Guide: Testing for weak cryptography</a></p>
</li>
</ul>
<h2 id="list-of-mapped-cwes">List of Mapped CWEs</h2>
<p><a href="https://cwe.mitre.org/data/definitions/261.html">CWE-261 Weak Encoding for Password</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/296.html">CWE-296 Improper Following of a Certificate's Chain of Trust</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/310.html">CWE-310 Cryptographic Issues</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/319.html">CWE-319 Cleartext Transmission of Sensitive Information</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/321.html">CWE-321 Use of Hard-coded Cryptographic Key</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/322.html">CWE-322 Key Exchange without Entity Authentication</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/323.html">CWE-323 Reusing a Nonce, Key Pair in Encryption</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/324.html">CWE-324 Use of a Key Past its Expiration Date</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/325.html">CWE-325 Missing Required Cryptographic Step</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/326.html">CWE-326 Inadequate Encryption Strength</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/327.html">CWE-327 Use of a Broken or Risky Cryptographic Algorithm</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/328.html">CWE-328 Reversible One-Way Hash</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/329.html">CWE-329 Not Using a Random IV with CBC Mode</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/330.html">CWE-330 Use of Insufficiently Random Values</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/331.html">CWE-331 Insufficient Entropy</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/335.html">CWE-335 Incorrect Usage of Seeds in Pseudo-Random Number Generator(PRNG)</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/336.html">CWE-336 Same Seed in Pseudo-Random Number Generator (PRNG)</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/337.html">CWE-337 Predictable Seed in Pseudo-Random Number Generator (PRNG)</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/338.html">CWE-338 Use of Cryptographically Weak Pseudo-Random Number Generator(PRNG)</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/340.html">CWE-340 Generation of Predictable Numbers or Identifiers</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/347.html">CWE-347 Improper Verification of Cryptographic Signature</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/523.html">CWE-523 Unprotected Transport of Credentials</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/720.html">CWE-720 OWASP Top Ten 2007 Category A9 - Insecure Communications</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/757.html">CWE-757 Selection of Less-Secure Algorithm During Negotiation('Algorithm Downgrade')</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/759.html">CWE-759 Use of a One-Way Hash without a Salt</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/760.html">CWE-760 Use of a One-Way Hash with a Predictable Salt</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/780.html">CWE-780 Use of RSA Algorithm without OAEP</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/818.html">CWE-818 Insufficient Transport Layer Protection</a></p>
<p><a href="https://cwe.mitre.org/data/definitions/916.html">CWE-916 Use of Password Hash With Insufficient Computational Effort</a></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>© Copyright 2021 - OWASP Top 10 team - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.en_US">Creative Commons Attribution 3.0 Unported License</a>.</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/jquery-3.6.0.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
